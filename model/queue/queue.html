<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Model Queue Demo</title>
</head>
<body>
	
	<div id='task'></div>


	<script id="taskEJS" type="text/ejs">
		Insert task, it will be saved on every keystroke, but requests will be done in the correct order<br>
		<input placeholder='Task...' style='width: 300px; font-size: 16px' /><br><span><%= pending() %></span> pending requests
	</script>

	<script src='../../lib/steal/steal.js'></script>
	<script type='text/javascript'>
	steal(function() {
		steal.config({
			root: '../../'
		});
	}).then('can', 'can/model/queue', 'can/control', 'can/util/fixture', function(){
		var Task  = can.Model({
			create : 'POST /task',
			update : 'PUT /task/{id}'
		}, {});

		can.fixture('POST /task', function(req){
			var task = req.data;
			task.id = 1;
			return task;
		})

		can.fixture('PUT /task/1', function(req){
			return req.data;
		})

		can.fixture.delay = 1000;

		var TaskControl = can.Control({
			init : function(){
				this.pending = can.compute(0);
				this.element.html(can.view('taskEJS', {
					pending : this.pending
				}));
				this.task = new Task
			},
			'input keyup' : function(el, ev){
				this.task.attr('title', el.val());
				this.task.save($.proxy(this.saved,this));
				this.pending(this.pending() + 1);
			},
			saved : function(){
				this.pending(this.pending() - 1);
			}
		})

		new TaskControl('#task');
	
	});
</script>
</body>
</html>